03.11.23 - preliminary results

Ticker        R^2                 Days       n_SMA
--------------------------------------------------
AAPL      0.01864 (   0.01764)      8 (  4)      3 (  1)
BAC      -0.00343 (  -0.00457)      3 (  2)      2 (  2)
COST      0.13559 (   0.13537)     10 (  9)     19 ( 18)
C         0.00720 (  -0.00645)      2 (  1)      1 (  7)
DG        0.00371 (   0.00093)      6 (  5)      2 (  2)
FB        0.05290 (   0.04788)      5 (  4)      6 (  6)
HSBC      0.01824 (   0.01267)      3 (  2)      1 (  1)
JPM      -0.01379 (  -0.02942)      1 (  1)      2 (  1)

04.11.23 - First results with dependent variable as a flexible mean, covering n_future days

Ticker        R^2                 Days       n_SMA       n_future
-----------------------------------------------------------------
AAPL      0.02480 (   0.02455)      6 (  6)     17 ( 17)         8 (        6)
BAC       0.00026 (  -0.00018)      4 (  3)     12 ( 12)         1 (        1)
COST      0.06092 (   0.05711)      9 (  7)     16 ( 16)        10 (       10)
C         0.00722 (   0.00099)      2 (  1)      1 ( 20)         1 (        2)
DG        0.01292 (   0.00944)      7 (  5)      9 ( 18)         2 (        2)
FB        0.06486 (   0.05884)     10 (  6)     10 ( 18)         5 (        8)
HSBC      0.01981 (   0.01823)      7 (  3)      2 (  1)         1 (        1)
JPM       0.00436 (   0.00224)      4 (  3)     12 ( 12)         2 (        2)

Performance Summary:
Metric        R^2                Days               n_SMA               n_fut
Average   0.02439 ( 0.02140)  6.12500 ( 4.25000)  9.87500 (14.25000)  3.75000 ( 4.00000)
Median    0.01637 ( 0.01383)  6.50000 ( 4.00000) 11.00000 (16.50000)  2.00000 ( 2.00000)
StDev     0.02508 ( 0.02417)  2.69590 ( 2.05287)  5.84166 ( 6.06512)  3.53553 ( 3.50510)

##### 04.11.23 - new results, solved bug (dataframe was reduced during tests)

Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.01332 (   0.00878)      6 (  6)     13 ( 13)      8 (  7)
BAC      -0.00120 (  -0.00232)      4 (  3)     13 ( 13)      1 (  1)
COST      0.18193 (   0.17626)      9 (  9)     13 ( 13)     22 ( 21)
C         0.00722 (  -0.00139)      2 (  1)     13 ( 13)      1 (  2)
DG        0.00890 (   0.00539)      7 (  5)     13 ( 13)      2 (  2)
FB        0.04299 (   0.03557)      1 (  1)     13 ( 13)      8 (  6)
HSBC      0.01823 (   0.01249)      3 (  2)     13 ( 13)      1 (  1)
JPM       0.00169 (  -0.00328)      4 (  3)     13 ( 13)      2 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.03413 ( 0.02894)  4.50 ( 3.75) 13.00 (13.00)  5.62 ( 5.12)
Median    0.01111 ( 0.00709)  4.00 ( 3.00) 13.00 (13.00)  2.00 ( 2.00)
StDev     0.06126 ( 0.06084)  2.67 ( 2.76)  0.00 ( 0.00)  7.27 ( 6.83)

(wrong n_ma printed)

####

Total time: 1130.50 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.02232 (   0.01743)     10 (  8)     10 (  3)      1 (  3)
BAC      -0.00068 (  -0.00268)      3 (  2)      2 (  4)      1 (  1)
COST      0.18193 (   0.17626)      9 (  9)     21 ( 21)     22 ( 21)
C         0.00722 (  -0.00139)      2 (  1)      1 ( 10)      1 (  2)
DG        0.00890 (   0.00539)      7 (  5)      9 ( 18)      2 (  2)
FB        0.04299 (   0.03557)      1 (  1)      8 (  8)      8 (  6)
HSBC      0.01823 (   0.01249)      3 (  2)      1 (  1)      1 (  1)
JPM       0.00169 (  -0.00328)      4 (  3)     12 ( 12)      2 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.03532 ( 0.02997)  4.88 ( 3.88)  8.00 ( 9.62)  4.75 ( 4.62)
Median    0.01356 ( 0.00894)  3.50 ( 2.50)  8.50 ( 9.00)  1.50 ( 2.00)
StDev     0.06086 ( 0.06054)  3.36 ( 3.14)  6.80 ( 7.15)  7.36 ( 6.82)

#### improved runtime by moving mean-calculation

Total time: 11 minutes and 24 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.02600 (   0.02362)     11 ( 11)     10 ( 10)      3 (  1)
BAC      -0.00068 (  -0.00268)      3 (  2)      2 (  4)      1 (  1)
COST      0.18193 (   0.17626)      9 (  9)     21 ( 21)     22 ( 21)
C         0.00722 (  -0.00139)      2 (  1)      1 ( 10)      1 (  2)
DG        0.00890 (   0.00539)      7 (  5)      9 ( 18)      2 (  2)
FB        0.04299 (   0.03557)      1 (  1)      8 (  8)      8 (  6)
HSBC      0.01823 (   0.01249)      3 (  2)      1 (  1)      1 (  1)
JPM       0.00169 (  -0.00328)      4 (  3)     12 ( 12)      2 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.03578 ( 0.03075)  5.00 ( 4.25)  8.00 (10.50)  5.00 ( 4.38)
Median    0.01356 ( 0.00894)  3.50 ( 2.50)  8.50 (10.00)  2.00 ( 1.50)
StDev     0.06076 ( 0.06039)  3.59 ( 3.81)  6.80 ( 6.63)  7.25 ( 6.93)

#### with MACD - not bad

Total time: 18 minutes and 6 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
BAC       0.49893 (   0.49396)      1 (  1)     13 ( 12)     10 ( 10)
COST      0.18605 (   0.18426)      8 (  8)     18 ( 18)     23 ( 22)
C         0.37695 (   0.35105)      1 (  1)     10 (  9)      4 (  4)
DG        0.02432 (   0.01602)      7 (  4)     18 ( 18)      2 (  2)
FB        0.41177 (   0.38585)      1 (  1)     12 ( 11)     10 (  9)
HSBC      0.16450 (   0.12144)      1 (  1)      5 (  4)      3 (  3)
JPM       0.21626 (   0.17389)      1 (  1)     10 ( 10)      4 (  3)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.26840 ( 0.24664)  2.86 ( 2.43) 12.29 (11.71)  8.00 ( 7.57)
Median    0.21626 ( 0.18426)  1.00 ( 1.00) 12.00 (11.00)  4.00 ( 4.00)
StDev     0.16601 ( 0.16807)  3.18 ( 2.70)  4.64 ( 4.99)  7.37 ( 7.09)

#### add signal_line - not bad either

best[AAPL] is: {'r_sq': -0.005045856918961089, 'days': 9, 'n_ma': 9, 'n_future': 1}
best[BAC] is: {'r_sq': 0.8155389007703508, 'days': 1, 'n_ma': 9, 'n_future': 9}
best[COST] is: {'r_sq': 0.21852042298916818, 'days': 8, 'n_ma': 17, 'n_future': 23}
best[C] is: {'r_sq': 0.7238593921478762, 'days': 1, 'n_ma': 6, 'n_future': 4}

#### add more MACD-features

Total time: 20 minutes and 49 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL     -0.00124 (  -0.01032)      9 (  9)      9 ( 13)      1 (  2)
BAC       0.81435 (   0.81421)      1 (  1)      8 (  9)      8 (  9)
COST      0.21395 (   0.20135)      8 (  8)     17 ( 17)     23 ( 22)
C         0.72633 (   0.69486)      1 (  1)      6 (  5)      4 (  4)
DG        0.02053 (   0.01697)      7 (  6)     18 ( 18)      2 (  3)
FB        0.69666 (   0.67713)      1 (  1)      8 (  9)      7 (  8)
HSBC      0.64074 (   0.54988)      1 (  1)      5 (  5)      4 (  3)
JPM       0.26229 (   0.19081)      1 (  1)     10 ( 10)      4 (  3)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.42170 ( 0.39186)  3.62 ( 3.50) 10.12 (10.75)  6.62 ( 6.75)
Median    0.45151 ( 0.37562)  1.00 ( 1.00)  8.50 ( 9.50)  4.00 ( 3.50)
StDev     0.33358 ( 0.32853)  3.66 ( 3.55)  4.82 ( 4.92)  7.01 ( 6.67)

#### correct indexing

Total time: 3 minutes and 19 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.01121 (   0.01067)     10 ( 11)     10 ( 10)      1 (  3)

Total time: 568 minutes and 43 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
BAC      -0.02956 (  -0.03016)      1 (  1)      8 (  9)      1 (  1)
COST      0.09549 (   0.07940)     12 ( 12)     16 ( 16)      8 (  7)
C         0.01015 (   0.00849)      2 (  3)      1 (  1)      1 (  1)
DG       -0.00595 (  -0.00686)      5 (  4)     18 ( 18)      2 (  2)
FB        0.07304 (   0.05569)     11 ( 11)     17 ( 18)      9 (  4)
HSBC      0.01734 (   0.01529)      7 (  9)      2 (  2)      1 (  1)
JPM      -0.04296 (  -0.04407)      1 (  2)      5 (  7)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.01679 ( 0.01111)  5.57 ( 6.00)  9.57 (10.14)  3.29 ( 2.43)
Median    0.01015 ( 0.00849)  5.00 ( 4.00)  8.00 ( 9.00)  1.00 ( 1.00)
StDev     0.05105 ( 0.04425)  4.61 ( 4.55)  7.32 ( 7.29)  3.59 ( 2.30)

#### add SelectKBest

best[AAPL] is: {'r_sq': -0.00014903903486240822, 'days': 12, 'n_ma': 10, 'n_future': 1
^that is of course weird
DG: new best[stock]:  {'r_sq': 0.5171016570696323, 'days': 1, 'n_ma': 9, 'n_future': 9
^that's pretty weird as well.
I had to redo the correction of the indexing.

#### 07.11.23 - results without MACD values

Total time: 9 minutes and 16 seconds
best:
 {'AAPL': {'r_sq': 0.013858790427647483, 'days': 7, 'n_ma': 7, 'n_future': 1, 'features': {'EMA_1': 1.0050740844957162, 'EMA_2': 0.01920883688612511, 'EMA_3': 0.8640108514382331, 'EMA_4': 5.221886121302395, 'EMA_5': 0.01958695677094788, 'EMA_6': 1.9618357528778465, 'EMA_7': 4.281295151931566}}, 'BAC': {'r_sq': -0.001933243580436228, 'days': 3, 'n_ma': 12, 'n_future': 1, 'features': {'EMA_1': 0.24494710786664425, 'EMA_2': 2.9918004395566116, 'EMA_3': 0.9450198723502438}}, 'COST': {'r_sq': 0.06865315210012612, 'days': 10, 'n_ma': 17, 'n_future': 9, 'features': {'EMA_1': 0.02800038624467411, 'EMA_2': 0.4809293003498888, 'EMA_3': 1.6437278136057936, 'EMA_4': 7.234347052369946, 'EMA_5': 15.09046179329542, 'EMA_6': 0.16992637179624825, 'EMA_7': 1.1863635147350944, 'EMA_8': 1.449623147938773, 'EMA_9': 1.491535802196059, 'EMA_10': 15.238730347308366}}, 'C': {'r_sq': 0.0058518870012292945, 'days': 3, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 0.23049353932389716, 'EMA_2': 10.314365152643713, 'EMA_3': 15.412287443116762}}, 'DG': {'r_sq': -0.0006030237321066334, 'days': 10, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 0.481985107169355, 'EMA_2': 3.065898898988223, 'EMA_3': 2.367429238506244, 'EMA_4': 0.31140034237975883, 'EMA_5': 1.0917249138057716, 'EMA_6': 6.127964157399324, 'EMA_7': 2.1158492657507444, 'EMA_8': 2.021860819353634, 'EMA_9': 0.14401296558159865, 'EMA_10': 5.452583958947063}}, 'FB': {'r_sq': 0.04186289491359696, 'days': 1, 'n_ma': 8, 'n_future': 8, 'features': {'EMA_1': 4.760604973017304}}, 'HSBC': {'r_sq': 0.008651654502893402, 'days': 4, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 2.9803728164618395, 'EMA_2': 2.9394411687572175, 'EMA_3': 3.6908952690013925, 'EMA_4': 5.9457904269472595}}, 'JPM': {'r_sq': -0.007129049937686371, 'days': 1, 'n_ma': 16, 'n_future': 1, 'features': {'EMA_1': 2.841925977638719}}}

Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.01386 (   0.01352)      7 (  3)      7 (  5)      1 (  1)
BAC      -0.00193 (  -0.00246)      3 (  1)     12 ( 10)      1 (  1)
COST      0.06865 (   0.06718)     10 ( 10)     17 ( 17)      9 ( 11)
C         0.00585 (  -0.00470)      3 (  1)      1 (  9)      1 (  7)
DG       -0.00060 (  -0.00478)     10 (  7)      1 (  1)      1 (  7)
FB        0.04186 (   0.03534)      1 (  1)      8 (  8)      8 (  6)
HSBC      0.00865 (   0.00816)      4 (  7)      1 (  4)      1 (  1)
JPM      -0.00713 (  -0.00770)      1 (  1)     16 ( 13)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.01615 ( 0.01307)  4.88 ( 3.88)  7.88 ( 8.38)  2.88 ( 4.38)
Median    0.00725 ( 0.00285)  3.50 ( 2.00)  7.50 ( 8.50)  1.00 ( 3.50)
StDev     0.02601 ( 0.02607)  3.68 ( 3.60)  6.64 ( 5.13)  3.48 ( 3.89)

#### with MACD values
Total time: 10 minutes and 15 seconds

Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL     -0.00975 (  -0.01640)      3 (  9)      5 ( 13)      1 (  3)
BAC      -0.03099 (  -0.03243)      1 (  1)     10 ( 12)      1 (  1)
COST      0.00530 (  -0.01067)     10 (  8)     17 ( 23)     11 ( 11)
C         0.00881 (   0.00112)      3 (  1)      1 (  1)      1 (  1)
DG       -0.01418 (  -0.01526)      1 ( 10)     19 (  1)      1 (  1)
FB        0.03833 (   0.03770)      7 (  3)     20 ( 20)      4 (  4)
HSBC      0.00885 (   0.00720)      4 ( 19)      1 (  4)      1 (  1)
JPM      -0.03976 (  -0.04069)      1 (  1)      1 (  4)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average  -0.00418 (-0.00868)  3.75 ( 6.50)  9.25 ( 9.75)  2.62 ( 2.88)
Median   -0.00222 (-0.01297)  3.00 ( 5.50)  7.50 ( 8.00)  1.00 ( 1.00)
StDev     0.02493 ( 0.02448)  3.24 ( 6.32)  8.40 ( 8.58)  3.54 ( 3.48)

The MACD doesn't really help yet.


### Updated data preparation with vectorization super fast! -.- 

Total time: 0 minutes and 49 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.00042 (  -0.00296)      4 (  6)      3 (  3)      1 (  3)
BAC      -0.02505 (  -0.02733)      2 (  1)      7 (  5)      1 (  1)
COST      0.12591 (   0.11091)      9 ( 13)     22 ( 16)     13 (  7)
C         0.01023 (   0.00881)      2 (  3)      1 (  1)      1 (  1)
DG       -0.01195 (  -0.01284)      2 (  3)     19 ( 19)      1 (  1)
FB        0.04873 (   0.04806)      9 ( 11)     20 ( 10)      3 (  5)
HSBC      0.01452 (   0.00725)      3 (  5)      1 (  1)      1 (  1)
JPM      -0.03163 (  -0.03838)      3 (  1)      1 (  3)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.01640 ( 0.01169)  4.25 ( 5.38)  9.25 ( 7.25)  2.75 ( 2.50)
Median    0.00533 ( 0.00214)  3.00 ( 4.00)  5.00 ( 4.00)  1.00 ( 1.00)
StDev     0.05094 ( 0.04787)  3.01 ( 4.47)  9.42 ( 6.98)  4.20 ( 2.33)


### With brute force SelectKBest n_features

Total time: 17 minutes and 21 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.06489 (   0.06483)     11 ( 12)     11 ( 11)      6 (  6)
BAC      -0.00238 (  -0.00238)      6 (  6)      9 (  9)      3 (  3)
COST      0.15757 (   0.15519)     13 ( 13)     16 ( 16)      9 ( 11)
C         0.01023 (   0.00936)      2 (  2)      1 (  1)      1 (  1)
DG        0.00447 (   0.00447)     13 ( 13)      1 (  1)      1 (  1)
FB        0.07727 (   0.07727)      2 (  2)     18 ( 18)      9 (  9)
HSBC      0.13725 (   0.13458)     17 ( 17)     17 ( 17)     19 ( 17)
JPM       0.07818 (   0.07448)     19 ( 19)     13 ( 13)     13 ( 13)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.06594 ( 0.06473) 10.38 (10.50) 10.75 (10.75)  7.62 ( 7.62)
Median    0.07108 ( 0.06965) 12.00 (12.50) 12.00 (12.00)  7.50 ( 7.50)
StDev     0.06013 ( 0.05918)  6.46 ( 6.48)  6.73 ( 6.73)  6.25 ( 5.88)

wow, that's amazing. On AAPL it runs best only with three features:
best[AAPL] is: {'r_sq': 0.06489245956000378, 'days': 11, 'n_ma': 11, 'n_future': 6, 'features': {'EMA_9': 10.936157005152639, 'MACD_crossover_up': 12.037145299231376, 'MACD_crossover_down': 12.037145299231348}}


### Running with RFECV with TimeSeriesSplit as cross-validator

Total time: 6 minutes and 48 seconds
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.02811 (   0.02600)     12 ( 12)      9 (  9)      6 (  4)
BAC      -0.00440 (  -0.00440)      1 (  1)      5 (  7)      1 (  1)
COST      0.14099 (   0.09104)      9 (  7)     22 ( 24)     11 ( 11)
C         0.00494 (   0.00482)      3 (  2)      1 (  1)      3 (  3)
DG        0.00447 (   0.00444)     13 ( 14)      1 (  1)      1 (  1)
FB        0.03655 (   0.03517)      6 (  7)     20 ( 20)      3 (  3)
HSBC      0.08411 (   0.05715)     17 ( 17)     17 ( 17)     13 ( 19)
JPM      -0.00613 (  -0.00613)      1 (  1)      3 (  5)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.03608 ( 0.02601)  7.75 ( 7.62)  9.75 (10.50)  4.88 ( 5.38)
Median    0.01652 ( 0.01541)  7.50 ( 7.00)  7.00 ( 8.00)  3.00 ( 3.00)
StDev     0.05178 ( 0.03413)  5.97 ( 6.19)  8.70 ( 8.78)  4.73 ( 6.41)

Faster but much worse results. With 'KFold' as cross-validator it was comparable.

Changing the StandardScaler to with_mean=True does not yield any better results:

Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.02811 (   0.02710)     12 ( 11)      9 (  9)      6 (  6)
BAC      -0.00440 (  -0.00440)      1 (  1)      5 (  7)      1 (  1)
COST      0.14099 (   0.09104)      9 (  7)     22 ( 24)     11 ( 11)
C         0.00494 (   0.00482)      3 (  2)      1 (  1)      3 (  3)
DG        0.00447 (   0.00444)     13 ( 14)      1 (  1)      1 (  1)
FB        0.03655 (   0.03517)      6 (  7)     20 ( 20)      3 (  3)
HSBC      0.08411 (   0.05715)     17 ( 17)     17 ( 17)     13 ( 19)
JPM      -0.00613 (  -0.00613)      1 (  1)      3 (  5)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.03608 ( 0.02615)  7.75 ( 7.50)  9.75 (10.50)  4.88 ( 5.62)
Median    0.01652 ( 0.01596)  7.50 ( 7.00)  7.00 ( 8.00)  3.00 ( 3.00)
StDev     0.05178 ( 0.03413)  5.97 ( 6.09)  8.70 ( 8.78)  4.73 ( 6.39)


### Results with SelectKBest and grid search again, but now with_mean=True in StandardScaler. And more result data:

len(df):  1258
stock_ranges: {'days': (1, 15, 1), 'n_ma': (1, 15, 2), 'n_future': (1, 15, 1)}
. . . . . . . . . . . . . . 
Time for AAPL: 2 minutes and 46 seconds.
best[AAPL] is: {'r_sq': 0.06489245956000378, 'days': 11, 'n_ma': 11, 'n_future': 6, 'features': {'EMA_9': 10.936157005152634, 'MACD_crossover_up': 12.037145299231232, 'MACD_crossover_down': 12.037145299231232}}

best n_feature is -8
secondbest[AAPL] is: {'r_sq': 0.0648271409647676, 'days': 12, 'n_ma': 11, 'n_future': 6, 'features': {'EMA_9': 11.007062898182946, 'MACD_crossover_up': 11.828400079213177, 'MACD_crossover_down': 11.828400079213177}}

secondbest n_feature is -9
len(df):  1259
stock_ranges: {'days': (1, 15, 1), 'n_ma': (5, 21, 2), 'n_future': (1, 15, 2)}
. . . . . . . . . . . . . . 
Time for BAC: 1 minutes and 38 seconds.
best[BAC] is: {'r_sq': -0.0023787161840931326, 'days': 6, 'n_ma': 9, 'n_future': 3, 'features': {'EMA_5': 7.030945849634106}}

best n_feature is -5
secondbest[BAC] is: {'r_sq': -0.0023787161840931326, 'days': 6, 'n_ma': 9, 'n_future': 3, 'features': {'EMA_5': 7.030945849634106}}

secondbest n_feature is -6
len(df):  1258
stock_ranges: {'days': (1, 15, 1), 'n_ma': (10, 25, 2), 'n_future': (1, 15, 2)}
. . . . . . . . . . . . . . 
Time for COST: 1 minutes and 35 seconds.
best[COST] is: {'r_sq': 0.15757482659049993, 'days': 13, 'n_ma': 16, 'n_future': 9, 'features': {'EMA_7': 18.755744150379474, 'EMA_12': 24.468728611690196}}

best n_feature is -11
secondbest[COST] is: {'r_sq': 0.1551926108755124, 'days': 13, 'n_ma': 16, 'n_future': 11, 'features': {'EMA_7': 20.728766339624357, 'EMA_12': 25.667970798452433}}

secondbest n_feature is -11
len(df):  1259
stock_ranges: {'days': (1, 15, 1), 'n_ma': (1, 11, 1), 'n_future': (1, 15, 2)}
. . . . . . . . . . . . . . 
Time for C: 1 minutes and 60 seconds.
best[C] is: {'r_sq': 0.010225550365437153, 'days': 2, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 15.459214058771664, 'EMA_2': 10.302841931650775, 'MACD_value': 0.35375402563212877, 'Signal_line': 0.03903134356530646, 'MACD_rate_of_change': 0.009665453354767267, 'MACD_crossover_up': 0.17242556645649693, 'MACD_crossover_down': 0.1724255664564969}}

best n_feature is 5
secondbest[C] is: {'r_sq': 0.009359069532784092, 'days': 2, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 15.459214058771664, 'EMA_2': 10.302841931650775, 'MACD_value': 0.35375402563212877, 'MACD_crossover_up': 0.17242556645649693, 'MACD_crossover_down': 0.1724255664564969}}

secondbest n_feature is 3
len(df):  1258
stock_ranges: {'days': (1, 15, 1), 'n_ma': (1, 21, 2), 'n_future': (1, 21, 2)}
. . . . . . . . . . . . . . 
Time for DG: 2 minutes and 52 seconds.
best[DG] is: {'r_sq': 0.004472674282567257, 'days': 13, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_5': 5.952110498502483}}

best n_feature is -12
secondbest[DG] is: {'r_sq': 0.004472674282567257, 'days': 13, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_5': 5.952110498502483}}

secondbest n_feature is -13
len(df):  1258
stock_ranges: {'days': (1, 15, 1), 'n_ma': (8, 21, 2), 'n_future': (1, 15, 2)}
. . . . . . . . . . . . . . 
Time for FB: 1 minutes and 23 seconds.
best[FB] is: {'r_sq': 0.07726864702106351, 'days': 2, 'n_ma': 18, 'n_future': 9, 'features': {'EMA_2': 10.93187095532533, 'MACD_crossover_up': 3.8634112591559764, 'MACD_crossover_down': 3.8634112591559764}}

best n_feature is 1
secondbest[FB] is: {'r_sq': 0.07726864702106351, 'days': 2, 'n_ma': 18, 'n_future': 9, 'features': {'EMA_2': 10.93187095532533, 'MACD_crossover_down': 3.8634112591559764}}

secondbest n_feature is 0
len(df):  1259
stock_ranges: {'days': (1, 21, 2), 'n_ma': (1, 18, 2), 'n_future': (1, 21, 2)}
. . . . . . . . . . 
Time for HSBC: 2 minutes and 17 seconds.
best[HSBC] is: {'r_sq': 0.13724893000243676, 'days': 17, 'n_ma': 17, 'n_future': 19, 'features': {'EMA_9': 22.3098336251711, 'EMA_10': 22.910584078071114}}

best n_feature is -15
secondbest[HSBC] is: {'r_sq': 0.13457984228363817, 'days': 17, 'n_ma': 17, 'n_future': 17, 'features': {'EMA_9': 20.881502271246827, 'EMA_10': 18.59902714115562}}

secondbest n_feature is -14
len(df):  1259
stock_ranges: {'days': (1, 21, 2), 'n_ma': (1, 18, 2), 'n_future': (1, 21, 2)}
. . . . . . . . . . 
Time for JPM: 2 minutes and 17 seconds.
best[JPM] is: {'r_sq': 0.0781819825301493, 'days': 19, 'n_ma': 13, 'n_future': 13, 'features': {'EMA_3': 11.68030009236269, 'EMA_4': 9.960363778882327, 'EMA_7': 23.627006660697084, 'EMA_11': 7.639992918037091, 'EMA_13': 12.702195248107598, 'EMA_17': 7.800913872267934, 'EMA_18': 7.803056648927197, 'MACD_crossover_up': 8.961316894143632, 'MACD_crossover_down': 8.961316894143632}}

best n_feature is -10
secondbest[JPM] is: {'r_sq': 0.07447934409049983, 'days': 19, 'n_ma': 13, 'n_future': 13, 'features': {'EMA_3': 11.68030009236269, 'EMA_4': 9.960363778882327, 'EMA_7': 23.627006660697084, 'EMA_13': 12.702195248107598, 'EMA_17': 7.800913872267934, 'EMA_18': 7.803056648927197, 'MACD_crossover_up': 8.961316894143632, 'MACD_crossover_down': 8.961316894143632}}

secondbest n_feature is -11
Total time: 16 minutes and 48 seconds
best:
 {'AAPL': {'r_sq': 0.06489245956000378, 'days': 11, 'n_ma': 11, 'n_future': 6, 'features': {'EMA_9': 10.936157005152634, 'MACD_crossover_up': 12.037145299231232, 'MACD_crossover_down': 12.037145299231232}}, 'BAC': {'r_sq': -0.0023787161840931326, 'days': 6, 'n_ma': 9, 'n_future': 3, 'features': {'EMA_5': 7.030945849634106}}, 'COST': {'r_sq': 0.15757482659049993, 'days': 13, 'n_ma': 16, 'n_future': 9, 'features': {'EMA_7': 18.755744150379474, 'EMA_12': 24.468728611690196}}, 'C': {'r_sq': 0.010225550365437153, 'days': 2, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 15.459214058771664, 'EMA_2': 10.302841931650775, 'MACD_value': 0.35375402563212877, 'Signal_line': 0.03903134356530646, 'MACD_rate_of_change': 0.009665453354767267, 'MACD_crossover_up': 0.17242556645649693, 'MACD_crossover_down': 0.1724255664564969}}, 'DG': {'r_sq': 0.004472674282567257, 'days': 13, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_5': 5.952110498502483}}, 'FB': {'r_sq': 0.07726864702106351, 'days': 2, 'n_ma': 18, 'n_future': 9, 'features': {'EMA_2': 10.93187095532533, 'MACD_crossover_up': 3.8634112591559764, 'MACD_crossover_down': 3.8634112591559764}}, 'HSBC': {'r_sq': 0.13724893000243676, 'days': 17, 'n_ma': 17, 'n_future': 19, 'features': {'EMA_9': 22.3098336251711, 'EMA_10': 22.910584078071114}}, 'JPM': {'r_sq': 0.0781819825301493, 'days': 19, 'n_ma': 13, 'n_future': 13, 'features': {'EMA_3': 11.68030009236269, 'EMA_4': 9.960363778882327, 'EMA_7': 23.627006660697084, 'EMA_11': 7.639992918037091, 'EMA_13': 12.702195248107598, 'EMA_17': 7.800913872267934, 'EMA_18': 7.803056648927197, 'MACD_crossover_up': 8.961316894143632, 'MACD_crossover_down': 8.961316894143632}}}
 
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.06489 (   0.06483)     11 ( 12)     11 ( 11)      6 (  6)
BAC      -0.00238 (  -0.00238)      6 (  6)      9 (  9)      3 (  3)
COST      0.15757 (   0.15519)     13 ( 13)     16 ( 16)      9 ( 11)
C         0.01023 (   0.00936)      2 (  2)      1 (  1)      1 (  1)
DG        0.00447 (   0.00447)     13 ( 13)      1 (  1)      1 (  1)
FB        0.07727 (   0.07727)      2 (  2)     18 ( 18)      9 (  9)
HSBC      0.13725 (   0.13458)     17 ( 17)     17 ( 17)     19 ( 17)
JPM       0.07818 (   0.07448)     19 ( 19)     13 ( 13)     13 ( 13)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.06594 ( 0.06473) 10.38 (10.50) 10.75 (10.75)  7.62 ( 7.62)
Median    0.07108 ( 0.06965) 12.00 (12.50) 12.00 (12.00)  7.50 ( 7.50)
StDev     0.06013 ( 0.05918)  6.46 ( 6.48)  6.73 ( 6.73)  6.25 ( 5.88)


### rfecv experimenting with number of splits in cross validation
LR on AAPL

Time for AAPL: 0 minutes and 1 seconds.
best[AAPL] is: {'r_sq': 0.028112834914657547, 'days': 12, 'n_ma': 9, 'n_future': 6, 'features': {'EMA_3': 1}}
best splits:  2
secondbest[AAPL] is: {'r_sq': 0.028112834914657547, 'days': 12, 'n_ma': 9, 'n_future': 6, 'features': {'EMA_3': 1}}
secondbest splits:  4
Total time: 0 minutes and 1 seconds
best:
 {'AAPL': {'r_sq': 0.028112834914657547, 'days': 12, 'n_ma': 9, 'n_future': 6, 'features': {'EMA_3': 1}}}
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.02811 (   0.02811)     12 ( 12)      9 (  9)      6 (  6)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.02811 ( 0.02811) 12.00 (12.00)  9.00 ( 9.00)  6.00 ( 6.00)
Median    0.02811 ( 0.02811) 12.00 (12.00)  9.00 ( 9.00)  6.00 ( 6.00)
StDev     0.00000 ( 0.00000)  0.00 ( 0.00)  0.00 ( 0.00)  0.00 ( 0.00)

Time for AAPL: 2 minutes and 52 seconds.
best[AAPL] is: {'r_sq': 0.024867225403663817, 'days': 13, 'n_ma': 9, 'n_future': 7, 'features': {'EMA_3': 1}}
best splits:  2
secondbest[AAPL] is: {'r_sq': 0.024867225403663817, 'days': 13, 'n_ma': 9, 'n_future': 7, 'features': {'EMA_3': 1}}
secondbest splits:  3
Total time: 2 minutes and 52 seconds
best:
 {'AAPL': {'r_sq': 0.024867225403663817, 'days': 13, 'n_ma': 9, 'n_future': 7, 'features': {'EMA_3': 1}}}
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.02487 (   0.02487)     13 ( 13)      9 (  9)      7 (  7)


################ WOW! EIN (rfecv) DURCHBRUCH! #########

Time for AAPL: 2 minutes and 16 seconds.
best[AAPL] is: {'r_sq': 0.0515747388195541, 'days': 12, 'n_ma': 9, 'n_future': 4, 'features': {'EMA_3': 1, 'EMA_11': 1}}
best splits:  3
secondbest[AAPL] is: {'r_sq': 0.028112834914657547, 'days': 12, 'n_ma': 9, 'n_future': 6, 'features': {'EMA_3': 1}}
secondbest splits:  2
Total time: 2 minutes and 16 seconds
best:
 {'AAPL': {'r_sq': 0.0515747388195541, 'days': 12, 'n_ma': 9, 'n_future': 4, 'features': {'EMA_3': 1, 'EMA_11': 1}}}
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.05157 (   0.02811)     12 ( 12)      9 (  9)      4 (  6)


Total time: 4 minutes and 26 seconds
best:
 {'AAPL': {'r_sq': 0.0515747388195541, 'days': 12, 'n_ma': 9, 'n_future': 4, 'features': {'EMA_3': 1, 'EMA_11': 1}}, 'BAC': {'r_sq': -0.004401535882659013, 'days': 1, 'n_ma': 10, 'n_future': 1, 'features': {'Signal_line': 1}}, 'COST': {'r_sq': 0.09912521182787126, 'days': 8, 'n_ma': 23, 'n_future': 13, 'features': {'EMA_5': 1}}, 'C': {'r_sq': 0.011514497591870176, 'days': 3, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 1, 'EMA_2': 1, 'MACD_value': 1, 'Signal_line': 1}}, 'DG': {'r_sq': 0.004472674282567257, 'days': 13, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_5': 1}}, 'FB': {'r_sq': 0.0334415780926518, 'days': 7, 'n_ma': 20, 'n_future': 4, 'features': {'EMA_2': 1, 'MACD_crossover_up': 1}}, 'HSBC': {'r_sq': 0.07415475285917783, 'days': 19, 'n_ma': 16, 'n_future': 9, 'features': {'EMA_11': 1}}, 'JPM': {'r_sq': -0.006131242752965171, 'days': 1, 'n_ma': 4, 'n_future': 1, 'features': {'Signal_line': 1}}}
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.05157 (   0.02811)     12 ( 12)      9 (  9)      4 (  6)
BAC      -0.00440 (  -0.00440)      1 (  1)     10 ( 10)      1 (  1)
COST      0.09913 (   0.09913)      8 (  8)     23 ( 23)     13 ( 13)
C         0.01151 (   0.00540)      3 (  1)      1 (  5)      1 (  3)
DG        0.00447 (   0.00447)     13 ( 13)      1 (  1)      1 (  1)
FB        0.03344 (   0.01962)      7 (  3)     20 ( 20)      4 (  8)
HSBC      0.07415 (   0.07415)     19 ( 19)     16 ( 16)      9 (  9)
JPM      -0.00613 (  -0.00613)      1 (  1)      4 (  4)      1 (  1)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.03297 ( 0.02754)  8.00 ( 7.25) 10.50 (11.00)  4.25 ( 5.25)
Median    0.02248 ( 0.01251)  7.50 ( 5.50)  9.50 ( 9.50)  2.50 ( 4.50)
StDev     0.03895 ( 0.03880)  6.39 ( 6.86)  8.47 ( 7.93)  4.50 ( 4.50)

### new best AAPL (linear regression)
all best splits from 2 to 4

Total time: 8 minutes and 58 seconds
best:
 {'AAPL': {'r_sq': 0.06697945736093858, 'days': 14, 'n_ma': 8, 'n_future': 5, 'features': {'EMA_12': 1, 'MACD_crossover_down': 1}}, 'BAC': {'r_sq': -0.005934273547365532, 'days': 4, 'n_ma': 9, 'n_future': 1, 'features': {'Signal_line': 1}}, 'COST': {'r_sq': 0.12862014296508584, 'days': 13, 'n_ma': 16, 'n_future': 12, 'features': {'EMA_7': 1, 'EMA_10': 1, 'EMA_12': 1}}, 'C': {'r_sq': 0.011514497591870176, 'days': 3, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_1': 1, 'EMA_2': 1, 'MACD_value': 1, 'Signal_line': 1}}, 'DG': {'r_sq': 0.004472674282567257, 'days': 13, 'n_ma': 1, 'n_future': 1, 'features': {'EMA_5': 1}}, 'FB': {'r_sq': 0.04449225103060206, 'days': 2, 'n_ma': 17, 'n_future': 6, 'features': {'EMA_2': 1, 'MACD_crossover_down': 1}}, 'HSBC': {'r_sq': 0.11487262519345487, 'days': 17, 'n_ma': 19, 'n_future': 12, 'features': {'EMA_9': 1}}, 'JPM': {'r_sq': -0.0405181513891788, 'days': 20, 'n_ma': 16, 'n_future': 9, 'features': {'EMA_11': 1}}}
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL      0.06698 (   0.05157)     14 ( 12)      8 (  9)      5 (  4)
BAC      -0.00593 (  -0.00593)      4 (  4)      9 (  9)      1 (  1)
COST      0.12862 (   0.10183)     13 ( 13)     16 ( 16)     12 (  9)
C         0.01151 (   0.00739)      3 (  2)      1 (  1)      1 (  2)
DG        0.00447 (   0.00447)     13 ( 13)      1 (  1)      1 (  1)
FB        0.04449 (   0.03276)      2 (  3)     17 ( 19)      6 (  6)
HSBC      0.11487 (   0.11487)     17 ( 17)     19 ( 19)     12 ( 12)
JPM      -0.04052 (  -0.04052)     20 ( 20)     16 ( 16)      9 (  9)

Performance Summary:
Metric        R^2                Days                n_ma               n_fut
Average   0.04056 ( 0.03331) 10.75 (10.50) 10.88 (11.25)  5.88 ( 5.50)
Median    0.02800 ( 0.02008) 13.00 (12.50) 12.50 (12.50)  5.50 ( 5.00)
StDev     0.05961 ( 0.05369)  6.84 ( 6.74)  7.20 ( 7.42)  4.73 ( 4.17)

### random forest (well, a first run)

Fitting 4 folds for each of 100 candidates, totalling 400 fits
Best parameters found:  {'n_estimators': 100, 'min_samples_split': 2, 'min_samples_leaf': 4, 'max_depth': None}
best[AAPL] is: {'r_sq': -0.35281603084836033, 'days': 14, 'n_ma': 8, 'n_future': 5, 'features': {'EMA_1': 1, 'EMA_2': 1, 'EMA_3': 1, 'EMA_4': 1, 'EMA_5': 1, 'EMA_6': 1, 'EMA_7': 1, 'EMA_8': 1, 'EMA_9': 1, 'EMA_10': 1, 'EMA_11': 1, 'EMA_12': 1, 'EMA_13': 1, 'EMA_14': 1, 'MACD_value': 1, 'Signal_line': 1, 'MACD_rate_of_change': 1, 'MACD_crossover_up': 1, 'MACD_crossover_down': 1}}
best splits:  4
secondbest[AAPL] is: {'r_sq': -1000000000.0}
secondbest splits:  None
. 
Time for AAPL: 0 minutes and 50 seconds.
best[AAPL] is: {'r_sq': -0.35281603084836033, 'days': 14, 'n_ma': 8, 'n_future': 5, 'features': {'EMA_1': 1, 'EMA_2': 1, 'EMA_3': 1, 'EMA_4': 1, 'EMA_5': 1, 'EMA_6': 1, 'EMA_7': 1, 'EMA_8': 1, 'EMA_9': 1, 'EMA_10': 1, 'EMA_11': 1, 'EMA_12': 1, 'EMA_13': 1, 'EMA_14': 1, 'MACD_value': 1, 'Signal_line': 1, 'MACD_rate_of_change': 1, 'MACD_crossover_up': 1, 'MACD_crossover_down': 1}}
best splits:  4
secondbest[AAPL] is: {'r_sq': -1000000000.0}
secondbest splits:  None
Total time: 0 minutes and 50 seconds
best:
 {'AAPL': {'r_sq': -0.35281603084836033, 'days': 14, 'n_ma': 8, 'n_future': 5, 'features': {'EMA_1': 1, 'EMA_2': 1, 'EMA_3': 1, 'EMA_4': 1, 'EMA_5': 1, 'EMA_6': 1, 'EMA_7': 1, 'EMA_8': 1, 'EMA_9': 1, 'EMA_10': 1, 'EMA_11': 1, 'EMA_12': 1, 'EMA_13': 1, 'EMA_14': 1, 'MACD_value': 1, 'Signal_line': 1, 'MACD_rate_of_change': 1, 'MACD_crossover_up': 1, 'MACD_crossover_down': 1}}}
Ticker        R^2                 Days        n_ma      n_future
----------------------------------------------------------------
AAPL     -0.35282 (-1000000000.00000)     14 (n/a)      8 (n/a)      5 (n/a)